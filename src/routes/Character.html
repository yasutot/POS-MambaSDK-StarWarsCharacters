<AppBarModifier title="Character" />

<div class="character-container">
  {#if character}
    <div class="character-card">
      <div class="character-card-header">
        {character.name}
      </div>
      <div class="character-card-body">
        <div>birth_year: {character.birth_year}</div>
        <div>species: {character.species_names.join(" / ")}</div>
        <div>eye_color: {character.eye_color}</div>
        <div>gender: {character.gender}</div>
        <div>hair_color: {character.hair_color}</div>
        <div>height: {character.height}</div>
        <div>homeworld_name: {character.homeworld_name}</div>
        <div>mass: {character.mass}</div>
        <div>skin_color: {character.skin_color}</div>
        <div>starships: { character.starships.length ? character.starships_names.join(',') : "None" }</div>
        <div>vehicles: { character.vehicles.length ? character.vehicles_names.join(',') : "None" }</div>
      </div>
    </div>
  {:else}
    <div class="center-content-hv">
      <CircularProgress height="50" />
    </div>
  {/if}
  <div class="bottom justify-content">
    <!-- <div class="justify-content"> -->
      <Button size="small" disabled="{ !character }">Imprimir</Button>
      <Button size="small" on:click="getRandomCharacter()" disabled="{ !character }">Novo</Button>
    <!-- </div> -->
  </div>
</div>
<!-- <Button bottom size="small">asd</Button> -->

<script>
  import axios from 'axios';

  export default {
    components: {
      AppBarModifier: '@mamba/appbar/Modifier.html',
      Button: '@mamba/button/Button.html',
      CircularProgress: '@mamba/progress/Circular.html',
    },
    data() {
      return {
        character: null,
      };
    },
    oncreate() {
      this.getRandomCharacter();
    },
    methods: {
      async getRandomCharacter() {
        this.set({character: null});
        const characterIndex = Math.floor(Math.random() * 87 + 1);
        await axios.get(`https://swapi.co/api/people/${characterIndex}`)
          .then(response => {
            this.character = Object.assign({}, response.data);
          })
          .then(() => this.getResourcesNames(this.character.homeworld))
          .then(res => this.character.homeworld_name = res)
          .then(() => this.getResourcesNames(this.character.species))
          .then(res => this.character.species_names = res)
          .then(() => this.getResourcesNames(this.character.starships))
          .then(res => this.character.starships_names = res)
          .then(() => this.getResourcesNames(this.character.vehicles))
          .then(res => this.character.vehicles_names = res)
          .then(() => this.set({ character: this.character }))
          .then(() => console.log(this.character));
      },
      async getResourcesNames(url) {
        if (!url) return;

        if (url.constructor === Array) {
          const promises = url.map(el => axios.get(el));
          return axios.all(promises)
            .then(responses => responses.map(response => response.data.name));
        }

        return axios.get(url).then(response => response.data.name);
      },
    },
  };
</script>

<style type="text/postcss">
  .character-container {
    /* height: calc( 100% - 40px ); */
    /* padding: 0.7em; */
  }
  .character-card {
    border: 1px solid #4ebf1a;
    height: 100%
  }
  .character-card-header {
    padding: 1em;
    background-color: #4ebf1a;
  }
  .character-card-body {
    padding: 0.5em;
  }
  .center-content-hv {
    position: absolute;
    top: 50%;
    left: 50%;
    -moz-transform: translateX(-50%) translateY(-50%);
    -webkit-transform: translateX(-50%) translateY(-50%);
    transform: translateX(-50%) translateY(-50%);
  }
  .bottom {
    position: absolute;
    bottom: 0;
    width: 100%;
  }
  .justify-content {
    display: flex;
    justify-content: space-around;
  }
</style>